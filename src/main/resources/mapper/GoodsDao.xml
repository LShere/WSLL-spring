<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="spring.dao.GoodsDao">
    <resultMap id="goods" type="spring.pojo.Goods">
    </resultMap>

    <select id="findAllGoods" resultMap="goods">
		select goods_id,
        goods_type,
        goods_name,
        goods_describe,
        goods_price,
        goods_enable,
        goods_browse,
        goods_buy,
        goods_picture_path
		from goods
	</select>

    <select id="findGoodsPage" resultMap="goods" parameterType="Map">
        select g.goods_id,
        t.type_name as goods_type,
        g.goods_name,
        g.goods_describe,
        g.goods_price,
        g.goods_enable,
        g.goods_browse,
        g.goods_buy,
        g.goods_picture_path
        from goods g
        left join (select type_id,type_name from g_type
        ) t
        on g.goods_type=t.type_id
 		<where>
            <if test="goods_id!=null and goods_id!=''">
                goods_id=#{goods_id}
            </if>
            <if test="goods_type!=null and goods_type!=''">
                and goods_type=#{goods_type}
            </if>
            <if test="goods_name!=null and goods_name!=''">
                and goods_name like "%"#{goods_name}"%"
            </if>
            <if test="goods_describe!=null and goods_describe!=''">
                and goods_describe=#{goods_describe}
            </if>
        </where>
    </select>

    <select id="countGoods" resultType="int">
        select count(*) from goods
    </select>

    <select id="findGoodsById" resultMap="goods" parameterType="int">
        select goods_id,
        goods_type,
        goods_name,
        goods_describe,
        goods_price,
        goods_enable,
        goods_browse,
        goods_buy,
        goods_picture_path
		from goods
		where goods_id=#{id}
    </select>

    <select id="findGoodsByRand" parameterType="int" resultMap="goods">
        SELECT * FROM `goods`
        WHERE goods_id >= (SELECT floor(RAND() * (SELECT MAX(goods_id) FROM `goods`)))
        ORDER BY goods_id LIMIT #{num};
    </select>

</mapper>
